<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Seattle Crime Map</title>
<meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">

<link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet">
<script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>

<style>
body { margin: 0; padding: 0; }
#map { position: absolute; top: 0; bottom: 0; width: 100%; }

#menu {
    position: absolute;
    background: #fff;
    padding: 10px;
    font-family: Arial, sans-serif;
    top: 10px;
    right: 10px;
    border-radius: 4px;
    box-shadow: 0 0 5px rgba(0,0,0,0.3);
}

#menu a {
    display: block;
    margin-bottom: 5px;
    padding: 6px;
    text-decoration: none;
    background: #eee;
    color: #000;
    border-radius: 3px;
    font-size: 13px;
}

#menu a.active {
    background: #3887be;
    color: #fff;
}
</style>
</head>

<body>

<nav id="menu"></nav>
<div id="map"></div>

<script>
mapboxgl.accessToken = 'pk.eyJ1IjoidmFtaWthZ29lbCIsImEiOiJjbWxiZGFpdjkwbHR1M2ZzOXZzdDA1aHc0In0.NJ-x0kZxeRad7lUM9BDi6Q';

const map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/mapbox/light-v10',
    center: [-122.3035, 47.6553],
    zoom: 13
});

map.addControl(new mapboxgl.NavigationControl());
map.addControl(new mapboxgl.ScaleControl());

map.on('load', () => {

    // SOURCES
    map.addSource('tileset1', {
        type: 'raster',
        tiles: ['assets/tileset_1/{z}/{x}/{y}.png'],
        tileSize: 256
    });

    map.addSource('tileset2', {
        type: 'raster',
        tiles: ['assets/tileset_2/{z}/{x}/{y}.png'],
        tileSize: 256
    });

    map.addSource('tileset3', {
        type: 'raster',
        tiles: ['assets/tileset_3/{z}/{x}/{y}.png'],
        tileSize: 256
    });

    map.addSource('tileset4', {
        type: 'raster',
        tiles: ['assets/tileset_4/{z}/{x}/{y}.png'],
        tileSize: 256
    });

    // LAYERS
    map.addLayer({
        id: 'Basemap',
        type: 'raster',
        source: 'tileset1',
        layout: { visibility: 'visible' }
    });

    map.addLayer({
        id: 'Crime Data',
        type: 'raster',
        source: 'tileset2',
        layout: { visibility: 'none' }
    });

    map.addLayer({
        id: 'Basemap + Crime',
        type: 'raster',
        source: 'tileset3',
        layout: { visibility: 'none' }
    });

    map.addLayer({
        id: 'Crime Hotspots',
        type: 'raster',
        source: 'tileset4',
        layout: { visibility: 'none' }
    });
});


// LECTURER-STYLE LAYER TOGGLE
map.on('idle', () => {

    const toggleableLayerIds = [
        'Basemap',
        'Crime Data',
        'Basemap + Crime',
        'Crime Hotspots'
    ];

    for (const id of toggleableLayerIds) {

        if (document.getElementById(id)) continue;

        const link = document.createElement('a');
        link.id = id;
        link.href = '#';
        link.textContent = id;
        link.className = map.getLayoutProperty(id, 'visibility') === 'visible' ? 'active' : '';

        link.onclick = function (e) {
            e.preventDefault();
            e.stopPropagation();

            const visibility = map.getLayoutProperty(id, 'visibility');

            if (visibility === 'visible') {
                map.setLayoutProperty(id, 'visibility', 'none');
                this.className = '';
            } else {
                map.setLayoutProperty(id, 'visibility', 'visible');
                this.className = 'active';
            }
        };

        document.getElementById('menu').appendChild(link);
    }
});
</script>

</body>
</html>
